pipeline
{
    agent any
    tools{
        maven "MAVEN_HOME"
        jdk "JAVA-17"
    }
    environment{
        GIT_URL="https://github.com/DevopsTech12/vprofile-project.git"   
         }
    stages{
        stage("scm chekout")
        {
            steps{ git branch: 'local', url: "$GIT_URL" }
        }
        stage("test")
        {
            steps{sh 'mvn test'}
        }
        stage("build artifact")
        {
            steps{sh 'mvn package -Dskiptest'}
            post{
                success{
                    echo "archiving artifact"
                    sleep 10
                    archiveArtifacts artifacts: '**/*.war'
                }
            }
        }
        stage("checkstyle checks")
        {
            steps{sh 'mvn checkstyle:checkstyle'}
        }

        stage("sonar qube analysis")
        {
            steps{ withSonarQubeEnv(credentialsId: 'SonarToken', installationName: 'SonarServer') {
            sh 'mvn sonar:sonar'
}}
        

    }
}
     post{
        always{
        slackSend channel: '#devops', 
        color: '#439FE0', 
        message: "*${CurrentBuild.current Result}:*job.${env.JOB_NAME}.build.${env.BUILD_NUMBER}", 
        teamDomain: 'vbtech-workspace', 
        tokenCredentialId: 'Slack-Jenkins'
       
     }
     }
}